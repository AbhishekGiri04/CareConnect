#!/usr/bin/env node\n\nconst fs = require('fs');\nconst path = require('path');\n\n// Security check for CareConnect\nfunction securityCheck() {\n    console.log('ðŸ”’ CareConnect Security Check');\n    console.log('=' .repeat(30));\n    \n    let issues = [];\n    let warnings = [];\n    \n    // Check for sensitive files\n    const sensitiveFiles = [\n        'firebase-service-account.json',\n        'backend/firebase-service-account.json',\n        'frontend/firebase-service-account.json',\n        '.env.production',\n        'backend/.env.production',\n        'frontend/.env.production'\n    ];\n    \n    sensitiveFiles.forEach(file => {\n        if (fs.existsSync(file)) {\n            issues.push(`âŒ Sensitive file found: ${file}`);\n        }\n    });\n    \n    // Check .gitignore\n    const gitignorePath = '.gitignore';\n    if (fs.existsSync(gitignorePath)) {\n        const gitignoreContent = fs.readFileSync(gitignorePath, 'utf8');\n        const requiredEntries = [\n            'firebase-service-account.json',\n            '.env',\n            'node_modules/',\n            '*.log'\n        ];\n        \n        requiredEntries.forEach(entry => {\n            if (!gitignoreContent.includes(entry)) {\n                warnings.push(`âš ï¸  .gitignore missing: ${entry}`);\n            }\n        });\n    } else {\n        issues.push('âŒ .gitignore file not found');\n    }\n    \n    // Check environment files\n    const envFiles = ['backend/.env', 'frontend/.env'];\n    envFiles.forEach(envFile => {\n        if (fs.existsSync(envFile)) {\n            const envContent = fs.readFileSync(envFile, 'utf8');\n            \n            // Check for placeholder values\n            if (envContent.includes('YOUR_') || envContent.includes('your-')) {\n                warnings.push(`âš ï¸  ${envFile} contains placeholder values`);\n            }\n            \n            // Check for hardcoded secrets\n            if (envContent.includes('-----BEGIN PRIVATE KEY-----')) {\n                warnings.push(`âš ï¸  ${envFile} contains private key (consider using key file)`);\n            }\n        }\n    });\n    \n    // Check file permissions (Unix-like systems)\n    if (process.platform !== 'win32') {\n        envFiles.forEach(envFile => {\n            if (fs.existsSync(envFile)) {\n                const stats = fs.statSync(envFile);\n                const mode = stats.mode & parseInt('777', 8);\n                if (mode & parseInt('044', 8)) {\n                    warnings.push(`âš ï¸  ${envFile} is readable by others (chmod 600 recommended)`);\n                }\n            }\n        });\n    }\n    \n    // Report results\n    console.log('\\nðŸ“Š Security Check Results:');\n    \n    if (issues.length === 0 && warnings.length === 0) {\n        console.log('âœ… No security issues found!');\n    } else {\n        if (issues.length > 0) {\n            console.log('\\nðŸš¨ Critical Issues:');\n            issues.forEach(issue => console.log(`  ${issue}`));\n        }\n        \n        if (warnings.length > 0) {\n            console.log('\\nâš ï¸  Warnings:');\n            warnings.forEach(warning => console.log(`  ${warning}`));\n        }\n        \n        console.log('\\nðŸ’¡ Recommendations:');\n        console.log('  â€¢ Remove sensitive files from repository');\n        console.log('  â€¢ Use environment variables for secrets');\n        console.log('  â€¢ Ensure .gitignore includes all sensitive patterns');\n        console.log('  â€¢ Set proper file permissions (600) for .env files');\n        console.log('  â€¢ Review SECURITY_SETUP.md for detailed instructions');\n    }\n    \n    return { issues: issues.length, warnings: warnings.length };\n}\n\nif (require.main === module) {\n    const results = securityCheck();\n    process.exit(results.issues > 0 ? 1 : 0);\n}\n\nmodule.exports = securityCheck;